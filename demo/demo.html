<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Universal Adaptor: Converting Mel-Spectrograms Between Different Configurations for Speech Synthesis</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="jquery-3.5.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/css/bootstrap.min.css"
        integrity="sha384-VCmXjywReHh4PwowAiWNagnWcLhlEJLA5buUprzK8rxFgeH0kww/aWY76TfkUoSX" crossorigin="anonymous">
    <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="manifest" href="favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>

<body>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">Audio Demo</h1>
            <p class="content-title">Universal Adaptor: Converting Mel-Spectrograms Between Different Configurations for Speech Synthesis
            </p>
            <hr class="my-4">
            <p>
                <b>Abstract:</b>
                Most recent TTS systems are composed of a synthesizer and a vocoder. However, the existing synthesizers and vocoders can only 
                be matched to a specific configuration. Hence, we can't combine arbitrary synthesizers and vocoders together to form a complete 
                TTS system, not to mention applying to a newly developed model. In this paper, we proposed a universal adaptor, which takes a 
                Mel-spectogram parametrized by the source configuration and converts it into a Mel-spectrogram parametrized by the target configuration, 
                as long as we feed in the source configuration and target configuration. Our experiments have shown that the quality of speeches 
                synthesized from our output of the universal adaptor is comparable to those synthesized from ground truth Mel-spectrogram. Moreover, 
                our universal adaptor can be applied in the recent TTS systems and in multi-speaker speech synthesis.
            </p>
            <p>
                <!-- <a href="https://github.com/yistLin/FragmentVC" type="button" class="btn btn-dark">GitHub (Source Code)</a> -->
                <a href="https://arxiv.org/abs/2104.02901" type="button" class="btn btn-danger">arXiv (Preprint)</a>
            </p>
        </div>
    </div>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <script src="wavesurfer.js"></script>

    <div class="content-container">
        <div class="content-title">LJSpeech</div>
        <div id='descript'>
        </div>
        <div id='legend'>
            <ul style="list-style-type:circle">
            </ul>
        </div>

        <div class="option-div" id="lj_source-div">
            <label for="lj_source">Choose the source configuration:</label>
            <select id="lj_source" onchange=record(this)>
                <option value="lj_src1">configuration 1</option>
                <option value="lj_src2">configuration 2</option>
                <option value="lj_src3">configuration 3</option>
                <option value="lj_src4">configuration 4</option>
            </select>
        </div>

        <div class="option-div" id="lj_target-div">
            <label for="lj_target">Choose the target configuration:</label>
            <select id="lj_target" onchange=record(this)>
                <option value="lj_tgt1">configuration 1 (WaveRNN)</option>
                <option value="lj_tgt2">configuration 2 (WaveGlow)</option>
                <option value="lj_tgt3">configuration 3 (HiFiGAN)</option>
                <option value="lj_tgt4">configuration 4 (MelGAN)</option>
            </select>
        </div>

        <div id="ljspeech-div"></div>

        <div class="content-title">TTS</div>
        <div id='descript'>
        </div>
        <div id='legend'>
            <ul style="list-style-type:circle">
            </ul>
        </div>
        <div class="option-div" id="tts_source-div">
            <label for="tts_source">Choose the source configuration:</label>
            <select id="tts_source" onchange=record(this)>
                <option value="tts_src1">configuration 1 (Tacotron)</option>
                <option value="tts_src2">configuration 2 (Tacotron 2)</option>
                <option value="tts_src3">configuration 3 (FastSpeech 2)</option>
            </select>
        </div>

        <div class="option-div" id="tts_target-div">
            <label for="tts_target">Choose the target configuration:</label>
            <select id="tts_target" onchange=record(this)>
                <option value="tts_tgt1">configuration 1 (WaveRNN)</option>
                <option value="tts_tgt2">configuration 2 (WaveGlow)</option>
                <option value="tts_tgt3">configuration 3 (HiFiGAN)</option>
                <option value="tts_tgt4">configuration 4 (MelGAN)</option>
            </select>
        </div>

        </div>
        <div id="tts-div"></div>

        <div class="content-title">CMU_ARCTIC</div>
        <div id='descript'>
        </div>
        <div id='legend'>
            <ul style="list-style-type:circle">
            </ul>
        </div>

        <div class="option-div" id="cmu_spk-div">
            <label for="cmu_speaker">Choose the speaker gender:</label>
            <select id="cmu_speaker" onchange=record(this)>
                <option value="male">male</option>
                <option value="female">female</option>
            </select>
        </div>
        
        <div class="option-div" id="cmu_source-div">
            <label for="cmu_source">Choose the source configuration:</label>
            <select id="cmu_source" onchange=record(this)>
                <option value="cmu_src1">configuration 1</option>
                <option value="cmu_src2">configuration 2</option>
                <option value="cmu_src3">configuration 3</option>
                <option value="cmu_src4">configuration 4</option>
            </select>
        </div>

        <div class="option-div" id="cmu_target-div">
            <label for="cmu_target">Choose the target configuration:</label>
            <select id="cmu_target" onchange=record(this)>
                <option value="cmu_tgt3">configuration 3 (HiFiGAN)</option>
            </select>
        </div>

        <div id="cmu-div"></div>
    </div>

    <div id="loading-status">Loading......</div>

    <script>
        var wavesurfer_lj = [1,2,3,4];
        var wavesurfer_tts = [1,2,3,4];
        var wavesurfer_cmu = [1,2,3,4];
    </script>

    <script>
        /* Highlights the navigation bar button corresponding to page
        to indicate which page a user is currently viewing.
        */
        var lj_source = "lj_src1";
        var lj_target = "lj_tgt1";
        var tts_source = "tts_src1";
        var tts_target = "tts_tgt1";
        var cmu_source = "cmu_src1";
        var cmu_target = "cmu_tgt3";
        var cmu_speaker = "male";

        var utt_scenarios = ['gt', 'direct', 'no_unet', 'unet'];    

        var config_mapping = {
            "lj_src1": "Configuration 1",
            "lj_src2": "Configuration 2",
            "lj_src3": "Configuration 3",
            "lj_src4": "Configuration 4",
            "lj_tgt1": "Configuration 1",
            "lj_tgt2": "Configuration 2",
            "lj_tgt3": "Configuration 3",
            "lj_tgt4": "Configuration 4",
            "tts_src1": "Configuration 1",
            "tts_src2": "Configuration 2",
            "tts_src3": "Configuration 3",
            "tts_tgt1": "Configuration 1",
            "tts_tgt2": "Configuration 2",
            "tts_tgt3": "Configuration 3",
            "tts_tgt4": "Configuration 4",
            "cmu_src1": "Configuration 1",
            "cmu_src2": "Configuration 2",
            "cmu_src3": "Configuration 3",
            "cmu_src4": "Configuration 4",
            "cmu_tgt3": "Configuration 3",
        };


        function lock() {
            $('#lj_source').attr('disabled', 'disabled');
            $('#lj_target').attr('disabled', 'disabled');
            $('#tts_source').attr('disabled', 'disabled');
            $('#tts_target').attr('disabled', 'disabled');
            $('#cmu_source').attr('disabled', 'disabled');
            $('#cmu_target').attr('disabled', 'disabled');
            $('#cmu_speaker').attr('disabled', 'disabled');
            $('#loading-status').show();
        }
        function unlock() {
            $('#lj_source').removeAttr('disabled');
            $('#lj_target').removeAttr('disabled');
            $('#tts_source').removeAttr('disabled');
            $('#tts_target').removeAttr('disabled');
            $('#cmu_source').removeAttr('disabled');
            $('#cmu_target').removeAttr('disabled');
            $('#cmu_speaker').removeAttr('disabled');
            $('#loading-status').hide();
        }

        function preload(lj_source, lj_target, tts_source, tts_target, cmu_source, cmu_target, cmu_speaker, push) {
            lock();
            $('#lj_source').val(lj_source);
            $('#lj_target').val(lj_target);
            $('#tts_source').val(tts_source);
            $('#tts_target').val(tts_target);
            $('#cmu_source').val(cmu_source);
            $('#cmu_target').val(cmu_target);
            $('#cmu_speaker').val(cmu_speaker);

            $("#ljspeech-div").empty();
            $("#ljspeech-div").append(createTable("lj"));
            for (var j = 0; j < utt_scenarios.length; j++) {
                wavesurfer_lj[j] = WaveSurfer.create({
                    container: '#uttr-lj-' + utt_scenarios[j] + '-div',
                    waveColor: 'violet',
                    progressColor: 'purple',
                });
                wavesurfer_lj[j].load("./wavs/LJSpeech/" + utt_scenarios[j] + "/" + lj_source + "-" + lj_target + ".wav");
            }

            $("#tts-div").empty();
            $("#tts-div").append(createTable("tts"));
            for (var j = 0; j < utt_scenarios.length; j++) {
                wavesurfer_tts[j] = WaveSurfer.create({
                    container: '#uttr-tts-' + utt_scenarios[j] + '-div',
                    waveColor: 'violet',
                    progressColor: 'purple',
                });
                wavesurfer_tts[j].load("./wavs/tts/" + utt_scenarios[j] + "/" + tts_source + "-" + tts_target + ".wav");
            }

            $("#cmu-div").empty();
            $("#cmu-div").append(createTable("cmu"));
            for (var j = 0; j < utt_scenarios.length; j++) {
                wavesurfer_cmu[j] = WaveSurfer.create({
                    container: '#uttr-cmu-' + utt_scenarios[j] + '-div',
                    waveColor: 'violet',
                    progressColor: 'purple',
                });
                wavesurfer_cmu[j].load("./wavs/CMU/" + cmu_speaker + "/" + utt_scenarios[j] + "/" + cmu_source + "-" + cmu_target + ".wav");
            }

            unlock();
        }

        preload(lj_source, lj_target, tts_source, tts_target, cmu_source, cmu_target, cmu_speaker, true);

        function createTable(task) {
            var tableElem;
            tableElem = document.createElement('table');
            return speech_synthesis(task, tableElem);
        }

        function speech_synthesis(task, tableElem) {
            var headline, rowElem, colElem;

            headline = document.createElement('tr');

            colElem = document.createElement('td');
            colElem.appendChild(document.createTextNode('Scenario'));
            colElem.style.color = 'rgb(22, 38, 67)';
            colElem.style.center = true;
            headline.appendChild(colElem);

            colElem = document.createElement('td');
            colElem.appendChild(document.createTextNode('Source Configuration'));
            colElem.style.color = 'rgb(22, 38, 67)';
            colElem.style.center = true;
            headline.appendChild(colElem);

            colElem = document.createElement('td');
            colElem.appendChild(document.createTextNode('Target Configuration'));
            colElem.style.color = 'rgb(22, 38, 67)';
            colElem.style.center = true;
            headline.appendChild(colElem);

            colElem = document.createElement('td');
            colElem.appendChild(document.createTextNode('Synthesized result'));
            colElem.style.color = 'rgb(22, 38, 67)';
            colElem.style.center = true;
            headline.appendChild(colElem);

            colElem = document.createElement('td');
            colElem.style.color = 'rgb(22, 38, 67)';
            colElem.style.center = true;
            headline.appendChild(colElem);

            tableElem.appendChild(headline);

            var bg_color = 'white';
            var txt_color = 'rgb(22, 38, 67)';
            var scenarios = ["Ground Truth", "Direct", "Without UNet", "With UNet"];
            var table_src, table_tgt;

            var N = scenarios.length;
            for (var j = 0; j < N; j++) {
                rowElem = document.createElement('tr');
                rowElem.style.backgroundColor = bg_color;
                
                if ( j === 0 ) {
                    table_src = "-";
                    table_tgt = "-";
                }
                else if ( j === 1 ) {
                    if ( task === "lj" ) {
                        table_src = config_mapping[lj_target];
                        table_tgt = config_mapping[lj_target];
                    }
                    else if ( task === "tts" ) {
                        table_src = config_mapping[tts_source];
                        table_tgt = config_mapping[tts_source];
                    }
                    else if ( task === "cmu" ) {
                        table_src = config_mapping[cmu_target];
                        table_tgt = config_mapping[cmu_target];
                    }
                }
                else if ( task === 'lj' ) {
                    table_src = config_mapping[lj_source];
                    table_tgt = config_mapping[lj_target];
                }
                else if ( task === 'tts' ) {
                    table_src = config_mapping[tts_source];
                    table_tgt = config_mapping[tts_target];
                }
                else if ( task === 'cmu' ) {
                    table_src = config_mapping[cmu_source];
                    table_tgt = config_mapping[cmu_target];
                }
                    

                colElem = document.createElement('td');
                colElem.appendChild(document.createTextNode(scenarios[j]));
                colElem.style.color = txt_color;
                colElem.style.center = true;
                rowElem.appendChild(colElem);

                colElem = document.createElement('td');
                colElem.appendChild(document.createTextNode(table_src));
                colElem.style.color = txt_color;
                colElem.style.center = true;
                rowElem.appendChild(colElem);

                colElem = document.createElement('td');
                colElem.appendChild(document.createTextNode(table_tgt));
                colElem.style.color = txt_color;
                colElem.style.center = true;
                rowElem.appendChild(colElem);

                colElem = document.createElement('div');
                colElem.setAttribute("id",'uttr-' + task + '-' + utt_scenarios[j] + '-div');
                colElem.style.color = txt_color;
                colElem.style.center = true;
                rowElem.appendChild(colElem);

                colElem = document.createElement('td');
                var x = document.createElement("input");
                x.setAttribute("type", "button");
                x.setAttribute("value", "PLAY");
                x.setAttribute("class", "play_button-demo btn btn-primary");
                x.setAttribute("onclick", 'wavesurfer_' + task + '[' + j + '].playPause()');
                colElem.appendChild(x);
                colElem.style.color = txt_color;
                colElem.style.center = true;
                rowElem.appendChild(colElem);


                tableElem.appendChild(rowElem);

            }

            return tableElem;
        }
        function fetch_result() {
            $(window).ready(function () {
                lj_source = $("#lj_source").val();
                lj_target = $("#lj_target").val();
                tts_source = $("#tts_source").val();
                tts_target = $("#tts_target").val();
                cmu_source = $("#cmu_source").val();
                cmu_target = $("#cmu_target").val();
                cmu_speaker = $("#cmu_speaker").val();

                $("#ljspeech-div").empty();

                $("#lj_source").empty();
                $("#lj_source").append('<option value="lj_src1">configuration 1</option>');
                $("#lj_source").append('<option value="lj_src2">configuration 2</option>');
                $("#lj_source").append('<option value="lj_src3">configuration 3</option>');
                $("#lj_source").append('<option value="lj_src4">configuration 4</option>');
                $("#lj_source").val(lj_source);

                $("#lj_target").empty();
                $("#lj_target").append('<option value="lj_tgt1">configuration 1 (WaveRNN)</option>');
                $("#lj_target").append('<option value="lj_tgt2">configuration 2 (WaveGlow)</option>');
                $("#lj_target").append('<option value="lj_tgt3">configuration 3 (HiFiGAN)</option>');
                $("#lj_target").append('<option value="lj_tgt4">configuration 4 (MelGAN)</option>');
                $("#lj_target").val(lj_target);

                $("#ljspeech-div").append(createTable("lj"));
                
                for (var j = 0; j < utt_scenarios.length; j++) {
                    wavesurfer_lj[j] = WaveSurfer.create({
                        container: '#uttr-lj-' + utt_scenarios[j] + '-div',
                        waveColor: 'violet',
                        progressColor: 'purple',
                    });
                    wavesurfer_lj[j].load("./wavs/LJSpeech/" + utt_scenarios[j] + "/" + lj_source + '-' + lj_target + ".wav");
                }

                $("#tts-div").empty();
                
                $("#tts_source").empty();
                $("#tts_source").append('<option value="tts_src1">configuration 1 (Tacotron)</option>');
                $("#tts_source").append('<option value="tts_src2">configuration 2 (Tacotron 2)</option>');
                $("#tts_source").append('<option value="tts_src3">configuration 3 (FastSpeech 2)</option>');
                $("#tts_source").val(tts_source);

                $("#tts_target").empty();
                $("#tts_target").append('<option value="tts_tgt1">configuration 1 (WaveRNN)</option>');
                $("#tts_target").append('<option value="tts_tgt2">configuration 2 (WaveGlow)</option>');
                $("#tts_target").append('<option value="tts_tgt3">configuration 3 (HiFiGAN)</option>');
                $("#tts_target").append('<option value="tts_tgt4">configuration 4 (MelGAN)</option>');
                $("#tts_target").val(tts_target);

                $("#tts-div").append(createTable("tts"));

                for (var j = 0; j < utt_scenarios.length; j++) {
                    wavesurfer_tts[j] = WaveSurfer.create({
                        container: '#uttr-tts-' + utt_scenarios[j] + '-div',
                        waveColor: 'violet',
                        progressColor: 'purple',
                    });
                    wavesurfer_tts[j].load("./wavs/tts/" + utt_scenarios[j] + "/" + tts_source + '-' + tts_target + ".wav");
                }

                $("#cmu-div").empty();

                $("#cmu_speaker").empty();
                $("#cmu_speaker").append('<option value="male">male</option>');
                $("#cmu_speaker").append('<option value="female">female</option>');
                $("#cmu_speaker").val(cmu_speaker);
                
                $("#cmu_source").empty();
                $("#cmu_source").append('<option value="cmu_src1">configuration 1</option>');
                $("#cmu_source").append('<option value="cmu_src2">configuration 2</option>');
                $("#cmu_source").append('<option value="cmu_src3">configuration 3</option>');
                $("#cmu_source").append('<option value="cmu_src4">configuration 4</option>');
                $("#cmu_source").val(cmu_source);

                $("#cmu_target").empty();
                $("#cmu_target").append('<option value="cmu_tgt3">configuration 3 (HiFiGAN)</option>');
                $("#cmu_target").val(cmu_target);

                $("#cmu-div").append(createTable("cmu"));
                
                for (var j = 0; j < utt_scenarios.length; j++) {
                    wavesurfer_cmu[j] = WaveSurfer.create({
                        container: '#uttr-cmu-' + utt_scenarios[j] + '-div',
                        waveColor: 'violet',
                        progressColor: 'purple',
                    });
                    wavesurfer_cmu[j].load("./wavs/CMU/" + cmu_speaker + "/" + utt_scenarios[j] + "/" + cmu_source + '-' + cmu_target + ".wav");
                }

                unlock();
            });
        }

        function record(sel) {
            lock();
            fetch_result();
        }

        window.addEventListener('popstate', function (e) {
            preload(e.state["lj_source"], e.state["lj_target"], e.state["tts_source"], e.state["tts_target"], e.state["cmu_source"], e.state["cmu_target"], e.state["cmu_speaker"], false);
        });
    </script>


    <div class="container" style="padding-top: 60px;">
        <p class="text-center text-muted">&copy; 台大語音實驗室 NTU Speech Lab</p>
    </div>
</body>

</html>
